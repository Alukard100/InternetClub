<div class="top-section">

    <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput type="search" placeholder="Search" [formControl]="searchControl" />
    </mat-form-field>

    <button matButton="outlined" (click)="openAddUserDialog()">
        <mat-icon matPrefix>person_add</mat-icon>
        Add user
    </button>

</div>

<div class="bottom-section">
<div class="bottom-section mat-elevation-z2">

  <table mat-table [dataSource]="dataSource">

    <!-- User -->
    <ng-container matColumnDef="userId">
      <th mat-header-cell *matHeaderCellDef>Username</th>
      <td mat-cell *matCellDef="let user">
        {{ user.username }}
      </td>
    </ng-container>

    <!-- Total -->
    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total</th>
      <td mat-cell *matCellDef="let user">
        {{ user.totalMoneySpent }} KM
      </td>
    </ng-container>

    <!-- Status -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef class="right-cell">Status</th>
      <td mat-cell *matCellDef="let user" class="right-cell">
        <span class="status-pill">
            <span class="status-dot" [class.active]="isActive(user.status)"></span>
            {{ getStatusLabel(user.status) }}
        </span>
        
      </td>
    </ng-container>

    <!-- Time -->
    <ng-container matColumnDef="time">
      <th mat-header-cell *matHeaderCellDef class="right-cell">Time</th>
      <td mat-cell *matCellDef="let user" class="right-cell">
        
        <ng-container>

        @if (user.availableMinutes | minutesToTime:isActive(user.status); as time) {
            <span class="time-pill" [ngClass]="time.color">
                {{ time.text }}
            </span>
        }
            

        </ng-container>

      </td>
    </ng-container>

    <!-- Actions -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
      <td mat-cell *matCellDef="let user" class="actions-cell">
        <button mat-icon-button>
          <mat-icon>pause</mat-icon>
        </button>
        <button mat-icon-button>
          <mat-icon>schedule</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageSizeOptions]="[10, 20, 50]"
    (page)="onPageChange($event)">
  </mat-paginator>

</div>
</div>
